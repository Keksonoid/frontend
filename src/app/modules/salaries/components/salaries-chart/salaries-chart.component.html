<app-page-header>Зарплаты IT в Казахстане</app-page-header>

<div *ngIf="showDataStub" class="container mt-5 mb-3">

  <div *ngIf="!isAuthenticated" class="alert alert-primary" role="alert">
    <div class="mb-2 h3">Ваша зарплата «в рынке»?</div>
    <div class="mb-3">Зарегистрируйтесь и оставьте данные о своей зарплате, чтобы узнать, сколько зарабатывают другие IT-специалисты в Казахстане.</div>
    <div>
      <button class="btn btn-primary" (click)="openAddSalaryAction()">Зарегистрироваться</button>
    </div>
  </div>

  <div *ngIf="isAuthenticated" class="alert alert-warning" role="alert">
    <div class="mb-2 h3">Ваша зарплата «в рынке»?</div>
    <div class="mb-3">Оставьте данные о своей зарплате, чтобы узнать, сколько зарабатывают другие IT-специалисты в Казахстане.</div>
    <div>
      <button class="btn btn-dark" (click)="openAddSalaryAction()">Добавить зарплату</button>
    </div>
  </div>
</div>

<div class="container mb-5" *ngIf="salariesChart != null; else dataLoading">
    <div class="card">
      <div class="card-body">

        <div *ngIf="salariesChart" class="row">
          <div class="col-3 d-none d-md-block">
            <div>
              <div class="mb-3 text-muted">Квалификации:</div>
              <div title="Coming soon" class="mb-3" *ngFor="let grade of grades">
                <button disabled type="button" class="text-start btn btn-outline-secondary w-100" >{{ grade }}</button>
              </div>
            </div>

            <hr class="mb-3" />
            <div class="mb-3">
              <div class="mb-3 text-muted">Действия:</div>
              <div >
                <button type="button" class="btn btn-outline-dark w-100" (click)="openAddSalaryAction()">Добавить зарплату</button>
              </div>
            </div>

          </div>

          <div class="col-md-9">
            <div *ngIf="showDataStub" class="mb-3">
              <div class="h4">Демонстрационные данные:</div> 
            </div>

            <div class="mb-5 d-flex justify-content-between align-items-end">
              <app-salary-block-value
                [title]="'Медианная зарплата:'"
                [value]="salariesChart.medianSalary"></app-salary-block-value>

                <div *ngIf="salariesChart.medianRemoteSalary" class="d-none d-md-block">
                  <app-salary-block-remote-value
                    [title]="'На удаленке:'"
                    [value]="salariesChart.medianRemoteSalary"></app-salary-block-remote-value>
                </div>

            </div>

            <div class="mb-3 d-flex justify-content-between align-items-end">

              <app-salary-block-value
                [title]="'Средняя зарплата:'"
                [value]="salariesChart.averageSalary"></app-salary-block-value>

                <div *ngIf="salariesChart.averageRemoteSalary" class="d-none d-md-block">
                  <app-salary-block-remote-value
                    [title]="'На удаленке:'"
                    [value]="salariesChart.averageRemoteSalary"></app-salary-block-remote-value>
                </div>

            </div>
           

            <div *ngIf="!showDataStub" class="mb-3 fst-italic">
              <div class="text-muted">Рассчитано на основании {{ salariesChart.countOfRecords }} анкет(ы)</div>
            </div>

            <div *ngIf="showDataStub" class="mb-3">
              <div class="text-muted">Данные сгенерированы для <strong>демонстрации</strong>. 
                <button class="btn btn-outline-secondary btn-sm" (click)="openAddSalaryAction()">{{ isAuthenticated ? 'Добавить зарплату' : 'Зарегистрироваться' }}</button> для получения актуальных данных.</div>
            </div>

            <div *ngIf="salariesChart.salariesByMoneyBarChart" class="mt-5 mb-5">
              <div class="mb-3 h3">
                <span>По всем IT-специалистам</span>
                <span *ngIf="showDataStub" class="ms-2">(демонстрационные данные)</span>
              </div>
              <div *ngIf="!showDataStub" class="mb-3">
                <i>TODO: в скором времени будет добавлена возможность фильтрации данных по специальностям, грейдам и фреймворкам/языкам программирования</i>
              </div>

              <app-salaries-by-grades-chart [chart]="salariesChart"></app-salaries-by-grades-chart>
            </div>

          </div>
        </div>

        <div class="mb-3 text-muted text-end fst-italic">
          Идея подсмотрена у сервиса <a class="text-reset" href="https://career.habr.com/salaries" target="_blank">Habr.Карьера</a>, за что им большая благодарность.
        </div>
      </div>
    </div>
  </div>

  <app-add-salary-modal
    *ngIf="openAddSalaryModal"
    (closed)="closeAddSalaryAction()"
    (salaryAdded)="onSalaryAdded($event)"
  ></app-add-salary-modal>
  
  <ng-template #dataLoading>
    <div class="container mt-5">
      <app-data-loader></app-data-loader>
    </div>
  </ng-template>

